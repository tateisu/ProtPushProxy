# ProtPushProxy

SNSサーバ→アプリサーバ→プッシュサーバ→テストアプリの流れでプッシュメッセージの購読と受信を行うプロトタイプ。

## 構成

### PushReceiverApp
Android用のテストアプリ
- マストドンにOAuthログインする。
- UnifiedPushのディストリビューターを選ぶ。
- UPの中継URLをアプリサーバに登録する。

### AppServer
アプリサーバ。
- アプリから中継URLを受け取ってDBに覚える。
- SNSサーバからWebPushメッセージを受け取り中継URL(プッシュサーバ)に投げる。

### FcmV1Sender
- FCMの FCM V1 APIに適当なメッセージを投げるテスト。
- まだアプリサーバに統合されてない。

## 仕様

SNSサーバに登録するURLでデバイストークンやインストールIDや中継URLを漏らさない。URL中のパラメータは次の２つ。
- a: 中継に必要なパラメータのSHA256ダイジェスト。DB側で照合して情報を補うと中継できる。同一鯖複数アカウントでも同じにはならない。
- dh インストール時に生成したUUIDとアカウントのacctのハッシュ。アプリ側で既存の購読のエンドポイントURLを照合してこのパラメータが異なるなら、それは他の端末で作成したものなので購読を上書きしてはいけない。アプリサーバ側ではこのパラメータは見ていない。

